# Offline-First PWA Demo

Progressive Web App demonstrating Git operations that work completely offline in the browser.

## What This Demo Shows

- **Offline-first architecture**: All Git operations work without network connectivity
- **PWA installation**: Installable as a standalone application
- **Service worker caching**: Application works even when offline
- **Storage backends**: Switch between memory and persistent (OPFS) storage
- **Connection monitoring**: Visual indicator of online/offline status

## Features

### Storage Options

1. **In-Memory Storage**: Fast, temporary storage that clears on page refresh
2. **Persistent Storage (OPFS)**: Browser Origin Private File System for data persistence

### Git Operations

- Initialize a new repository
- Create and stage files
- Commit changes with messages
- View commit history

### PWA Capabilities

- Installable on desktop and mobile
- Works offline after first load
- Service worker caches all assets
- Responsive design

## Running the Demo

```bash
# Install dependencies
pnpm install

# Start development server
pnpm dev

# Build for production
pnpm build

# Preview production build
pnpm preview
```

## Architecture

```
src/
├── main.ts              # Application entry and UI logic
├── storage-manager.ts   # Storage backend management
public/
├── manifest.json        # PWA manifest (generated by vite-plugin-pwa)
├── sw.js               # Service worker (generated by vite-plugin-pwa)
```

## How It Works

### Storage Manager

The storage manager abstracts storage backends:

```typescript
import { createMemoryStorage, createPersistentStorage } from "./storage-manager.js";

// Use in-memory storage (temporary)
const memStorage = await createMemoryStorage();

// Use persistent OPFS storage
const persistentStorage = await createPersistentStorage();
```

### Git Operations

All Git operations use the VCS commands library:

```typescript
import { createGitStore, Git } from "@statewalker/vcs-commands";
import { createGitRepository } from "@statewalker/vcs-core";
import { MemoryStagingStore } from "@statewalker/vcs-store-mem";

// Initialize repository
const repository = await createGitRepository();
const staging = new MemoryStagingStore();
const store = createGitStore({ repository, staging });
const git = Git.wrap(store);

// Stage and commit files
const editor = store.staging.editor();
editor.add({ path: "file.txt", apply: () => ({ ... }) });
await editor.finish();

const commit = await git.commit().setMessage("Initial commit").call();
```

### PWA Configuration

The app uses `vite-plugin-pwa` for service worker generation:

```typescript
// vite.config.ts
import { VitePWA } from "vite-plugin-pwa";

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: "autoUpdate",
      workbox: {
        globPatterns: ["**/*.{js,css,html,ico,png,svg}"],
      },
    }),
  ],
});
```

## Browser Support

- Chrome 86+ (full OPFS support)
- Firefox 111+ (OPFS support)
- Safari 15.2+ (limited OPFS)
- Edge 86+ (full OPFS support)

## Key Concepts Demonstrated

1. **Offline-First Design**: The app prioritizes offline functionality
2. **Progressive Enhancement**: Falls back gracefully when features unavailable
3. **Storage Abstraction**: Clean separation between storage and application logic
4. **PWA Best Practices**: Installability, caching, and responsive design

## Dependencies

- `@statewalker/vcs-commands` - Git porcelain commands
- `@statewalker/vcs-core` - Core VCS types and utilities
- `@statewalker/vcs-store-mem` - In-memory storage
- `@statewalker/webrun-files-*` - File system abstractions
- `vite-plugin-pwa` - PWA generation for Vite
